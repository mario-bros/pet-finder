<%# @dog, @dogs are defined in the adoption_application_reviews controller %>

<% if @dog.nil? ? @collection = @dogs : @collection = @dog %>

  <% @collection.each do |dog| %>
    <!--dog name-->
    <div class='border border-gray-200 rounded-lg p-6 mt-8 bg-white shadow-sm'>
      <h4 class="text-center text-2xl font-bold">
        <%= link_to dog.name, dog_path(dog), class: 'no-underline text-[#00401F] hover:text-[#668C78]' %>
      </h4>

      <div class='mt-4'>
        <% dog.adopter_applications.each do |app|%>
          <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-center rounded py-3 px-3 mb-3
            <%= 'awaiting-review' if app.status == 'awaiting_review' %>
            <%= 'withdrawn' if app.status == 'withdrawn' %>
            <%= 'under-review' if app.status == 'under_review' %>
            <%= 'adoption-pending' if app.status == 'adoption_pending' %>
            <%= 'successful-applicant' if app.status == 'successful_applicant' %>">

            <!--applicant name-->
            <div class="flex items-center">
              <p class='text-lg'>
                Applicant: <%= app.adopter_account.user.first_name %>
                <%= app.adopter_account.user.last_name %>
              </p>
            </div>

            <!--application status-->
            <div class="flex items-center">
              <div class="<%= app.status == 'withdrawn' ? 'font-bold' : '' %> text-lg">
                Status: <%= app.status.titleize %>
              </div>
            </div>

            <% unless app.status == 'successful_applicant' %>
              <!--adopter profile link-->
              <div class="flex items-center justify-center">
                <%= link_to 'Adopter Profile', profile_review_path(app.adopter_account.adopter_profile.id),
                            class: 'text-lg text-[#00401F] hover:text-[#668C78]' %>
              </div>
            <% end %>

            <!--edit/create actions-->
            <div class="flex items-center justify-center">
              <%= link_to 'Edit Application', edit_adopter_application_path(app.id),
                          class: 'px-4 py-2 border border-gray-700 text-gray-700 rounded-lg hover:bg-gray-700 hover:text-white transition-colors font-medium' %>
            </div>

            <% if app.status == 'successful_applicant' %>
              <!--create adoption button-->
              <div class="flex items-center justify-center md:col-span-1">
                <%= link_to 'Create Adoption',
                            create_adoption_path(dog_id: dog.id, adopter_account_id: app.adopter_account.id),
                            data: { turbo_method: :post, turbo_confirm: "Click OK to finalize this adoption." },
                            class: 'custom-btn-pink mb-3 md:mb-0 py-2 px-4' %>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>

  <% end %>

<% end %>
