<header class="py-16"> 
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="text-center">
      <h1 class="text-4xl font-bold uppercase underline">
        <% if @dog.has_adoption_pending? %>
          <%= @dog.name %> (Adoption Pending)
        <% else %>
          <%= @dog.name %>
        <% end %>
      </h1>
    </div>
  </div>
</header>

<!--dog tile-->
<section class="pb-16" id="adoptable_dogs_show">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
      <div class="lg:col-span-2">
        <!--dog images--> 
        <% if @dog.images.attached? %>
          <div class="relative mb-12" data-controller="carousel">
            <!-- Image container -->
            <div class="relative overflow-hidden rounded-lg bg-gray-100" style="height: 700px;">
              <% @dog.images.each_with_index do |image, index| %>
                <div class="absolute inset-0 transition-opacity duration-500 <%= index == 0 ? 'opacity-100' : 'opacity-0' %>" 
                     data-carousel-target="slide" data-slide-index="<%= index %>">
                  <%= image_tag image, class: 'w-full h-full object-contain' %>
                </div>
              <% end %>
            </div>

            <!-- Navigation buttons -->
            <button class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-[#00401F] text-white p-3 rounded-full hover:bg-[#003018] transition-colors"
                    data-action="click->carousel#previous">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
            </button>
            <button class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-[#00401F] text-white p-3 rounded-full hover:bg-[#003018] transition-colors"
                    data-action="click->carousel#next">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </button>

            <!-- Indicators -->
            <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2 bg-[#00401F] bg-opacity-60 px-4 py-2 rounded-full">
              <% @dog.images.each_with_index do |image, index| %>
                <button class="w-3 h-3 rounded-full <%= index == 0 ? 'bg-white' : 'bg-gray-400' %> transition-colors"
                        data-action="click->carousel#goToSlide" data-slide-index="<%= index %>"
                        data-carousel-target="indicator"></button>
              <% end %>
            </div>
          </div>
        <% end %>

        <div class='grid grid-cols-2 md:grid-cols-4 gap-4 mb-6'>
          <div class='mb-2'>
            <h5 class='font-bold text-lg'>Age:</h5>
            <h5 class='text-lg'><%= "#{@dog.age}" " #{@dog.age_unit}" %></h5>
          </div>
          <div class='mb-2'>
            <h5 class='font-bold text-lg'>Sex:</h5>
            <h5 class='text-lg'><%= @dog.sex %></h5>
          </div>
          <div class='mb-2'>
            <h5 class='font-bold text-lg'>Breed:</h5>
            <h5 class='text-lg'><%= @dog.breed %></h5>
          </div>
          <div class='mb-2'>
            <h5 class='font-bold text-lg'>Size:</h5>
            <h5 class='text-lg'><%= @dog.size %></h5>
          </div>
        </div>

        <h4 class='font-bold text-2xl mb-4'>
          About <%= @dog.name %>
        </h4>
        <p class='text-lg leading-relaxed whitespace-pre-line'>
          <%= @dog.description %>
        </p>
      </div>

      <div class='lg:col-span-1'>
        <div class='border border-gray-200 p-8 rounded-lg flex flex-col justify-between bg-white shadow-sm'>
          <div>
            <h4 class='text-2xl font-bold mb-4'>
              Adoption Process
            </h4>
            <p class='mb-6 text-lg'>
              Please read the <%= link_to 'FAQ', faq_path, class: 'text-[#00401F] hover:text-[#668C78]' %> before 
              applying to adopt.
            </p>
            <p class='text-lg mb-3'>Please know that:</p>
            <ul class='text-lg mb-6 space-y-2'> 
              <li class='flex items-start'><span class='mr-2'>•</span>Adopters must be located in Canada, USA or Mexico</li>
              <li class='flex items-start'><span class='mr-2'>•</span>There is an adoption fee of $250 USD</li>
              <li class='flex items-start'><span class='mr-2'>•</span>Every dog will be fully vaccinated and have the necessary 
                  paperwork to enter Canada/USA</li>
              <li class='flex items-start'><span class='mr-2'>•</span>We can usually arrange transport to adopters west of Alberta or
                  Nevada only. Adopters further east will need to arrange 
                  transport before an adoption can be approved.</li>
            </ul>

            <p class='mt-6 text-lg mb-3'>After you apply to adopt:</p>
            <ul class='text-lg space-y-2'> 
              <li class='flex items-start'><span class='mr-2'>•</span>Your application history will be shown on 'My Applications' page</li>
              <li class='flex items-start'><span class='mr-2'>•</span>Application reviews generally take 4-6 days, depending on volume</li>
              <li class='flex items-start'><span class='mr-2'>•</span>We will contact you for further discussion if you are 
                  shortlisted</li>
              <li class='flex items-start'><span class='mr-2'>•</span>We work hard to match dogs and adopters, so please
                  try again if you are not successful first time round</li>
            </ul>
          </div>

          <div class='text-center flex flex-col items-center mt-8'>
            <% unless user_signed_in? && current_user.staff_account %>
              <% if user_signed_in? %>
                <% if current_user.adopter_account && 
                      current_user.adopter_account.adopter_profile %>
                  <% if AdopterApplication.adoption_exists?(
                                            current_user.adopter_account.id,
                                            @dog.id
                                                            ) %>
                    <div class='flex items-center mt-6'>
                      <h4 class="mr-3 text-xl font-semibold">Application submitted</h4>
                      <%= image_tag('green_check.png', height: '21') %>
                    </div>
                  <% elsif @dog.application_paused == true %>
                    <div class='flex items-center mt-6'>
                      <h3 class="mr-3 text-xl text-red-600 font-semibold">
                        Applications <%= @dog.pause_reason.titleize %>
                      </h3>
                    </div>
                  <% else %>   
                    <h4 class="mb-6 mt-6 text-xl font-semibold">In love with this pooch?</h4>
                    <%= button_to 'Apply to Adopt', 
                        create_my_application_path(application: { 
                                                        dog_id: @dog.id, 
                                                        adopter_account_id: current_user.adopter_account.id}),

                          class: 'custom-btn-pink' %>
                  <% end %>
                <% elsif current_user.adopter_account %>
                  <h4 class='mb-6 mt-6 text-xl font-semibold'>
                    Complete your profile to apply for this dog
                  </h4>
                  <%= link_to 'Complete my profile', new_profile_path,
                      class: 'custom-btn-pink' %>
                <% end %>
              <% else %>
                  <h4 class="mb-6 mt-6 text-xl font-semibold">
                    Create an account to apply for this dog
                  </h4>
                  <%= link_to 'Create Account', account_select_path , 
                      class: 'custom-btn-pink mb-4' %>
                  <p class='text-center'>
                    <%= link_to 'Log in', new_user_session_path, class: 'text-[#00401F] hover:text-[#668C78]' %>
                  </p>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
